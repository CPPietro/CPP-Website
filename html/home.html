<!DOCTYPE html>
<html>
    <head>
        <title>Raspberry Pi File Server</title>
        <link rel="stylesheet" href="/html/static/css/home_stylesheet.css">
    </head>
    <body>
        <div class="title">
            <h1>Welcome to the Raspberry Pi file server</h1>
            <h2>What would you like to do?</h2>
        </div>
        
        <div class="buttons">
            <button class="download_button" role="button" onclick="showTextBox()">Download</button>
            <button class="upload_button" role="button" onclick="showUploadBox()">Upload</button>
        </div>
        
        <!-- Download container -->
        <div id="textBoxContainer" style="display: none;">
            <p id="textBoxLabel">Enter download filename:</p>
            <input type="text" id="textBoxInput" placeholder="example.txt">
            <button id="downloadButton" onclick="cppDownload()"><span class="transition"></span>
  <span class="gradient"></span>
  <span class="label">Download</span></button>
        </div>
        
        <!-- Upload container -->
        <div id="upload_buttons" class="file-upload-wrapper" style="display: none;">
            <input type="file" id="fileInput">
            <label for="fileInput" class="file-upload-label">
                Choose File
            </label>
            <span class="file-name-display empty">No file selected</span>
            <button id="uploadButton" onclick="cppUpload()"><span class="transition"></span>
                <span class="gradient"></span>
                <span class="label">Upload</span></button>
        </div>
        <div class="list">
            <a id="list_link" href="/list" target="_blank">Click here to see the list of available files</a>
        </div>
        <script>
            function showTextBox() {
                const downloadContainer = document.getElementById('textBoxContainer');
                const uploadContainer = document.getElementById('upload_buttons');
                
                // Hide upload, show download
                uploadContainer.style.display = 'none';
                downloadContainer.style.display = 'block';
            }

            function showUploadBox() {
                const uploadContainer = document.getElementById('upload_buttons');
                const downloadContainer = document.getElementById('textBoxContainer');
                
                // Hide download, show upload
                downloadContainer.style.display = 'none';
                uploadContainer.style.display = 'block';
            }

            // Add event listener for file selection (runs once on page load)
            document.getElementById('fileInput').addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || 'No file selected';
                const display = document.querySelector('.file-name-display');
                display.textContent = fileName;
                display.classList.toggle('empty', !e.target.files[0]);
            });

            async function cppDownload() {
                const input = document.getElementById('textBoxInput');
                const file_name = input.value.trim();
                
                if (!file_name) {
                    //alert('Please enter a filename');
                    input.placeholder = "You must enter a filename!";
                    return;
                }
                
                try {
                    const response = await fetch('/download/' + encodeURIComponent(file_name));
                    
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = file_name;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                        
                        console.log('Download successful');
                    } else {
                        console.error('Download failed:', response.status);
                        alert('Download failed. Please try again.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred during download.');
                }
            }

            async function cppUpload() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Please select a file');
        return;
    }
    
    try {
        const formData = new FormData();
        // You can rename the file here if needed
        formData.append('file', file, file.name);
        
        const response = await fetch('/upload', {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            console.log('Upload successful');
            //alert('Upload successful!');
        } else {
            console.error('Upload failed:', response.status, response.statusText, response.type);
            alert('Upload failed. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred during upload.');
    }
}
        </script>
    </body>
</html>